/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: Maze Game
@author: Felix Gao
@tags: ["Maze", "Idk"]
@addedOn: 2024-00-00
*/

const player = "p";
const wall = "w";

const laserVert = "v";
const laserVertOff = "o";

const laserHorz = "h";
const laserHorzOff = "f";

const LevelUp = "l"

setLegend(
  [player, bitmap`
................
................
................
...666666666....
...666666666....
...666666666....
...666666666....
...666666666....
...666666666....
...666666666....
...666666666....
...666666666....
...666666666....
................
................
................`],
  [wall, bitmap`
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000`],
  [laserVert, bitmap`
................
................
................
................
................
L..............L
L1............1L
L13333333333331L
L1............1L
L..............L
................
................
................
................
................
................`],
  [laserVertOff, bitmap`
................
................
................
................
................
L..............L
L1............1L
L1............1L
L1............1L
L..............L
................
................
................
................
................
................`],
  [laserHorz, bitmap`
......LLLLL.....
.......111......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
........3.......
.......111......
......LLLLL.....`],
  [laserHorzOff, bitmap`
......LLLLL.....
.......111......
................
................
................
................
................
................
................
................
................
................
................
................
.......111......
......LLLLL.....`],
  [LevelUp, bitmap`
................
.DDD..DDDD..DDD.
.D............D.
.D.....DD.....D.
.......DD.......
.......DD.......
.D.....DD.....D.
.D.....DD.....D.
.D.....DD.....D.
.D..DD.DD.DD..D.
.....DDDDDD.....
......DDDD......
.D.....DD.....D.
.D............D.
.DDD..DDDD..DDD.
................`],


)

setSolids([player, wall]);

let level = 0
const levels = [
  map`
ww...w...w..
...w.wwwww.w
.w.w...h....
wwvwwwwwwww.
...w.h......
.www.wwwwvww
...w.w..w.w.
..pw.ww...w.
wwww.wwww...
l.......wwww`
]

const death = [
  map`
.......
.......
.......
.......
...p...
wwwwwww`
]

setMap(levels[level])

setPushables({
  [player]: []
})

// inputs for player movement control
onInput("w", () => {
  getFirst(player).y -= 1;
});

onInput("a", () => {
  getFirst(player).x -= 1;
});

onInput("s", () => {
  getFirst(player).y += 1;
});

onInput("d", () => {
  getFirst(player).x += 1;
});

let clear = false;

/* Enable and disable all lasers every 2 sec */
function updateGame() {
  if (clear) {
    getAll("f").forEach(sprite => {
      sprite.type = "h";
    });

    getAll("o").forEach(sprite => {
      sprite.type = "v";
    });
    clear = false;
  } else {
    getAll("h").forEach(sprite => {
      sprite.type = "f";
    });

    getAll("v").forEach(sprite => {
      sprite.type = "o";
    });
    clear = true;
  }
}

function setDeath(cause) {
  addText("You died! RIP!", options = { x: 3, y: 6, color: color`3` })
  setMap(death[0]);
}

/* After ALL THAT SETUP ABOVE ME comes the fun part! */

afterInput(() => {
  const items_insides = getTile(getFirst("p").x, getFirst("p").y);
  for (let sprite of items_insides) {
      if (sprite["_type"] == "h" || sprite["_type"] == "v") {
        setDeath()
      }
}
})

setInterval(updateGame, 1000);
